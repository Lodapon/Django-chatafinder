<!DOCTYPE html>
<html lang="th">
{% load static %}
{% load filters %}
<head>
    <meta charset="UTF-8">
    <title>‡πÑ‡∏û‡πà‡∏ó‡∏≤‡πÇ‡∏£‡∏ï‡πå</title>
    <style>
        body { font-family: sans-serif; margin: 30px auto; max-width: 600px; }
        .message { padding: 10px; margin-bottom: 10px; border-radius: 5px; }
        .user { background: #e0f7fa; text-align: right; }
        .bot { background: #fce4ec; }
        .card-list {
		    background-color: #f9f9f9;
		    border-radius: 10px;
		    padding: 15px;
		    margin-bottom: 20px;
		    border: 1px solid #ccc;
		}

		.card-grid {
		    display: grid;
		    grid-template-columns: repeat(5, 1fr); /* 5 cards per row */
		    gap: 12px;
		    justify-items: center;
		}

		.card-item {
		    text-align: center;
		    width: 80px;
		}

		.card-item img {
		    border-radius: 5px;
		    border: 1px solid #aaa;
		}
    </style>
</head>

<body>
    <h2>‡πÑ‡∏û‡πà‡∏ó‡∏≤‡πÇ‡∏£‡∏ï‡πå: ‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∂‡∏Å‡∏©‡∏≤‡πÇ‡∏ä‡∏Ñ‡∏ä‡∏∞‡∏ï‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏ï‡∏±‡∏ß</h2>

    {% if request.session.tarot_cards %}
    <div class="card-list">
	        <h3>üÉè ‡πÑ‡∏û‡πà‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏à‡∏±‡∏ö</h3>
	        <div class="card-grid">
	            {% for card in request.session.tarot_cards %}
	                <div class="card-item">
	                    <img src="{% static 'tarot_cards/' %}{{ card|card_image_filename }}" alt="{{ card }}" width="80">
	                    <small>{{ card }}</small>
	                </div>
	            {% endfor %}
	        </div>
	    </div>
	{% endif %}

    <div id="chat-box">
        {% if chat_history %}
            {% for msg in chat_history %}
                <div class="message {{ msg.sender }}">
                    <p>{{ msg.text }}</p>
                </div>
            {% endfor %}
        {% endif %}
    </div>

    <div id="loading" style="display:none; margin: 10px 0; color: #888;">
	    ‚ú® ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö...
	</div>

    <form method="post">
        {% csrf_token %}
        <input type="text" name="user_input" style="width: 80%;" required>
        <button type="submit">‡∏™‡πà‡∏á</button>
    </form>

    <form method="post" style="margin-top: 10px;">
	    {% csrf_token %}
	    <input type="hidden" name="reset" value="true">
	    <button type="submit">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà üîÑ</button>
	</form>

    <p><a href="{% url 'homepage' %}">‚¨ÖÔ∏è ‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a></p>

    <script>
	    const form = document.querySelector("form");
	    const loading = document.getElementById("loading");

	    form.addEventListener("submit", function (e) {
	        e.preventDefault();  // stop immediate submit
	        loading.style.display = "block";  // show loading
	        setTimeout(() => form.submit(), 100);  // submit after short delay
	    });
	</script>

</body>
</html>